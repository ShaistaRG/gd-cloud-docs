<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:mso="urn:schemas-microsoft-com:office:office" xmlns:msdt="uuid:C2F41010-65B3-11d1-A29F-00AA00C14882">

<head>


<title>Set Up a Local OSSEC Installation - Ubuntu, Debian</title>
<style type="text/css">
div.hacker {
background-color:#666;
border:1px solid #ccc;
color:#fff;
font-family:"Lucida Console","Courier New",Courier,fixed;  font-size:95%;  line-height:160%;  margin-bottom:1.5em;  padding:10px; }

p.note {
 background-color:#ffffe6;
 border:1px solid #eee;
 color:#666;
 padding:.8em 1.6em;
 margin:15px 0;
}

.warning {
 border: 1px #d25100 solid;
 padding: .5em 1em .5em 4em;
 margin: 10px 20px 15px 20px;
 background-image: url('@{help-img-path}/img_warning.gif');
 background-repeat: no-repeat;
 background-position: left top;
 background-color: #ededed;-moz-border-radius:
0.8em;-webkit-border-radius: 0.8em;
 /* -moz-border-bottom-radius: 0;9 */
 -webkit-border-bottom-radius: 0;
 padding-top:14px;
 padding-bottom:15px;
}
</style>


<!--[if gte mso 9]><xml>
<mso:CustomDocumentProperties>
<mso:ArticleKeywords msdt:dt="string">Monitoring</mso:ArticleKeywords>
<mso:Reference msdt:dt="string">https://www.digitalocean.com/community/tutorials/how-to-set-up-a-local-ossec-installation-on-fedora-21, https://www.digitalocean.com/community/tutorials/how-to-set-up-a-local-ossec-installation-on-fedora-21</mso:Reference>
<mso:LinuxDistributions msdt:dt="string">;#Ubuntu;#Debian;#</mso:LinuxDistributions>
<mso:ArticlePriority msdt:dt="string">10</mso:ArticlePriority>
<mso:RequestNotes msdt:dt="string"></mso:RequestNotes>
<mso:Difficulty msdt:dt="string">4</mso:Difficulty>
<mso:ForkSplit msdt:dt="string"></mso:ForkSplit>
<mso:ArticleID msdt:dt="string">19005</mso:ArticleID>
<mso:UnsupportedFeatures msdt:dt="string"></mso:UnsupportedFeatures>
<mso:Collapsed msdt:dt="string"></mso:Collapsed>
<mso:Complexity msdt:dt="string"></mso:Complexity>
<mso:ArticleStatus msdt:dt="string">Not started</mso:ArticleStatus>


<mso:Sample msdt:dt="string">z</mso:Sample>
<mso:DeliveryTarget msdt:dt="string"></mso:DeliveryTarget>
<mso:EditScore msdt:dt="string"></mso:EditScore>
<mso:PrereqOrdering msdt:dt="string">2</mso:PrereqOrdering>
<mso:AssignedTo1 msdt:dt="string">12</mso:AssignedTo1>
<mso:display_urn_x003a_schemas-microsoft-com_x003a_office_x003a_office_x0023_AssignedTo1 msdt:dt="string">Tom Taylor</mso:display_urn_x003a_schemas-microsoft-com_x003a_office_x003a_office_x0023_AssignedTo1>
</mso:CustomDocumentProperties>
</xml><![endif]-->
</head>

<body>
<p>Setting up a local OSSEC , Monitoring</p>
	<h1>Set Up a Local OSSEC Installation - Debian, Ubuntu </h1>
<p><strong>Difficulty: </strong> 4</p>
	<p><strong>Time: </strong> 45 Minutes</p>
	<p>
		This article explains installation of a local OSSEC on  Debian
or Ubuntu.</p>
	<p class="note">
 You need  <code>sudo</code> privileges to complete all steps. </p>
	<h2>Install Postfix</h2>
		<p>For sending mail from a local SMTP server, you  need to install Postfix.</p>
	<ol>
	
	  <li>
			
		Update the server.
			
			<div class="hacker">sudo apt-get update</div>
		</li>
		<li>
			Install the packages.
			<div class="hacker">sudo apt-get install build-essential inotify-tools</div>
		</li>
	</ol>
<h2>Download OSSEC and verify the package</h2>
	You  need to download the Ossec tarball and a file with its cryptographic checksum to make sure that you're installing valid software. Then you can generate the MD5 and SHA1 checksum and compare these with the checksum file.
	<ol>
	  <li>
			Download <code>ossec</code>.
<div class="hacker">sudo wget -U ossec http://www.ossec.net/files/ossec-hids-2.8.1.tar.gz</div></li>
													
			<li>Download the checksum file.
			  <div class="hacker">sudo wget -U ossec http://www.ossec.net/files/ossec-hids-2.8.1-checksum.txt</div>								
		</li>
		<li>
			Verify the <code>md5sum</code> of the compressed tarball.
			<div class="hacker">
			md5sum -c ossec-hids-2.8.1-checksum.txt
			</div>
			The output is as follows:
			<div class="hacker">
			
			ossec-hids-2.8.1.tar.gz: OK<br/>
			md5sum: WARNING: 1 line is improperly formatted
			
			</div>
		</li>
		<li>
			Verify SHA1 checksum.
			  <div class="hacker">
			sha1sum -c ossec-hids-2.8.1-checksum.txt
		  </div>
			The output is as follows:
			<div class="hacker">
			
			ossec-hids-2.8.1.tar.gz: OK<br/>
			sha1sum: WARNING: 1 line is improperly formatted
			
			</div>
			You can ignore the warnings, as the <strong>OK</strong> next tar output file confirms that the file is good to go<!--This sentence does not make sense. cj -->.
	  </li>
	</ol>
<h2>Find your SMTP server</h2>
	<p>During installation, OSSEC  asks for your SMTP server. To determine the correct SMTP server, follow these steps.</p>
	<ol>
		<li>Use <code>dig </code> command to query your providers mail exchange resource record.
			<div class="hacker">
				dig -t mx <em><u>coolexample.com</u></em>
		  </div>
			You will get answer in several sections but we are only interested in the ANSWER section.
			For example if you run the command using fastmail.com
			<div class="hacker">
				dig -t mx fastmail.com
			</div>
			The valid SMTP servers for providers are shown in the ANSWER section.
			<div class="hacker">
				<pre>
					;; ANSWER SECTION:
					fastmail.com.           3600    IN      MX      10 in1-smtp.messagingengine.com.
					fastmail.com.           3600    IN      MX      20 in2-smtp.messagingengine.com.
				</pre>
			</div>
			So in this example you can use <code>in1-smtp.messagingengine.com</code> or <code>in1-smtp.messagingengine.com</code> as SMTP server.
			</li>
			<li>Make a note of any of these SMTP servers.  You'll need it during installation.
		
		</li>
	</ol>
	<h2>Install OSSEC</h2>
	<ol>
  <!--Please make sure that the first sentence of each step contains an imperative statement. -->
		<li>You can install OSSEC in many modes including server, agent, local or hybrid mode. We will install in <code>local</code> mode in this article.
			Expand the file with:
			<div class="hacker">sudo tar -zxf ossec-hids-2.8.1.tar.gz</div>
			<p>If you get an error for <code>tar </code>command type <code>sudo yum install tar</code>.</p>
			Change the directory to the expanded one.
			<div class="hacker">cd ossec-hids-2.8.1</div>
			Initiate the installation with:
			<div class="hacker">sudo ./install.sh</div>
		</li>
		<li>
			It will prompt you to answer a few questions. First question will be to choose a language; you may choose your language as you want. To use default press <strong>Enter</strong>.
			<div class="hacker">
				<pre>
					OSSEC HIDS v2.8 Installation Script - http://www.ossec.net
					
					 You are about to start the installation process of the OSSEC HIDS.
					 You must have a C compiler pre-installed in your system.
					 If you have any questions or comments, please send an e-mail
					 to dcid@ossec.net (or daniel.cid@gmail.com).

					  - System: Linux ubuntu 3.13.0-55-generic
					  - User: root
					  - Host: ubuntu


					  -- Press ENTER to continue or Ctrl-C to abort. -

				</pre>
			</div>
		</li>
		<li>
			When prompted to enter the type of installation, type <code>local</code> and press <strong>Enter</strong>.
			<div class="hacker">
			1- What kind of installation do you want (server, agent, local, hybrid or help)? <em><u>local</u></em>
			</div>
		</li>
		<li>
			For the rest of the questions, you may press <strong>Enter</strong> to accept the defaults. However, in Question <strong>3.1</strong> it will prompt you for your email address and then SMTP server ip/host. Enter your email address and SMTP server that you got using the <code>dig</code> command.
			
		</li>
		<li>
			On successful installation you will get
			<div class="hacker">
				<pre>
				Thanks for using the OSSEC HIDS.
				If you have any question, suggestion or if you find any bug,
				contact us at contact@ossec.net or using our public maillist at
				ossec-list@ossec.net
				( http://www.ossec.net/main/support/ ).

				More information can be found at http://www.ossec.net

				---  Press ENTER to finish (maybe more information below). ---
				</pre>
			</div>
			<p>Press enter to finish the installation</p>
		</li>
		
	</ol>
<h2>Verify OSSEC's email settings</h2>
	Next you need to verify that the email credentials you provided and that OSSEC auto-configured are correct.
	<ol><!--Please make sure that each step begins with an imperative statement. cj-->
	  <li>
			Email settings are in <code>ossec.conf</code> file that resides in <code>/var/ossec/etc</code>. To access this file, switch to the root user.
			<div class="hacker">
				sudo su
			</div>
		</li>
		<li>
			Change the directory to the configuration file's directory.
			  <div class="hacker">
				cd /var/ossec/etc
			</div>	
		</li>
		<li>
			Optionally, make a backup copy of this file. 
			<div class="hacker">
				cp ossec.conf ossec.conf.00
			</div>
		</li>
		<li>
			<p>Open <code>ossec.conf</code> in any editor.</p>
		</li>
		<li>
			<p>Email settings are at the top and following is the description of the fields.</p>
			<ul>
				<li>
					<code>&lt;email_to></code> is the email address given by you during installation.
				</li>
				<li>
					<code>&lt;email_from></code> is the address where the mails would appear to come from.
				</li>
				<li>
					<code>&lt;smtp_server></code> is the SMTP server you gave during set up.
				</li>
			</ul>
		</li>
		<li>
			Update these settings as per your need and once you are finished, the final section will look like as shown.
			<div class="hacker">
				
				&lt;global><br/>
			&lt;email_notification><em><u>yes</u></em>&lt;/email_notification><br/>
			&lt;email_to><em><u>email@coolexample.com</u></em>&lt;/email_to><br/>
			&lt;smtp_server><em><u>mail.coolexample.com.</u></em>&lt;/smtp_server><br/>
			&lt;email_from><em><u>ossecm@ossec_server</u></em>&lt;/email_from><br/>
			&lt;/global><br/>
				
			</div>
		</li>
		<li>
			
				Save the file and start the server using the following command:
				<div class="hacker">
				/var/ossec/bin/ossec-control start
				</div>
				You should have received an email saying OSSEC has started. 
			
		</li>
	</ol>
		<h2>Add alerts</h2>
	Here you will get an overview of configuration settings and its<!--Please clarify what "its" refers to. cj --> directory structure.
<ol>
		<li>
			<h3>Directory structure</h3>
			Its root directory <code>/var/ossec</code> can only be accessed with root privileges.<!--Please remove <h3>s from within the steps. Also, make sure that each step begins with an imperative statement. Finally, some of this content doesn't look like procedures but like explanatory information. Explanatory information should not be presented in step format. cj -->
			<ul>
				<li>Its main configuration file resides in <code>/var/ossec/etc</code>.</li>
				<li><code>/var/ossec/rules </code> contains predefined rules.</li>
				<li><code>/var/ossec/bin </code> contains command used to manage OSSEC.</li>
				<li><code>/var/ossec/logs/ossec</code> log contains logs of the errors.</li>
			</ul>
		</li>
		<li>
		<h3>Main configuration file location</h3>
		The main configuration file is located at <code>/var/ossec/etc/ossec.conf</code>. Open it in any editor, make sure you have <code>sudo </code>privileges. First configuration option you will see is the email configuration you specified while installing. You can change it, if required at this place.

		<div class="hacker">
				
			&lt;global><br/>
			&lt;email_notification><em><u>yes</u></em>&lt;/email_notification><br/>
			&lt;email_to><em><u>email@coolexample.com</u></em>&lt;/email_to><br/>
			&lt;smtp_server><em><u>mail.coolexample.com.</u></em>&lt;/smtp_server><br/>
			&lt;email_from><em><u>ossecm@ossec_server</u></em>&lt;/email_from><br/>
			&lt;/global><br/>
			
			
		</div>
			<ul>
				<li>
				To change the number of email per hour you can add here the following line.
				<div class="hacker">&lt;email_maxperhour><em><u>N</u></em>&lt;/email_maxperhour></div>
				<p><em><u>N</u></em> is the number of emails. Make sure your <code>&lt;email_from></code> address contains a valid domain part as some third-party email provider may drop otherwise.</p>
				<p>If you are not getting emails as expected you can check logs here <code>/var/ossec/logs/ossec.log</code></p>
				</li>
			</ul>
		</li>
		<li>
		<h3>Frequency of scan </h3>
		The <code>&lt;syscheck></code> section starts like this.
		<div class="hacker">
			
				&lt;syscheck><br/>
				&lt;!-- Frequency that syscheck is executed - default to every 22 hours --><br/>
				&lt;frequency>79200&lt;/frequency><br/>
			
		</div>
		<p>So by default system check is run in every 22 hours. You can change it. 
		</p>
		To enable alerts for new file creation, add the below mentioned line
			
			<div class="hacker">&lt;alert_new_files>yes&lt;/alert_new_files></div>
			It should read.
			<div class="hacker">
				
					&lt;syscheck><br/>
					&lt;!-- Frequency that syscheck is executed - default to every 22 hours --><br/>
					&lt;frequency>79200&lt;/frequency><br/>
					&lt;alert_new_files>yes&lt;/alert_new_files><br/>
				
			</div>
  </li>
		<li>
		<h3>Directory and file configuration</h3>
		Right after that there is a list of system directory that it monitors as shown.
		<div class="hacker">
			
				&lt;!-- Directories to check  (perform all possible verifications) --><br/>
				&lt;directories check_all="yes">/etc,/usr/bin,/usr/sbin&lt;/directories><br/>
				&lt;directories check_all="yes">/bin,/sbin&lt;/directories><br/>
			
		</div>
		Add <code>report_changes="yes" realtime="yes"</code> to each line to enable real time monitoring as shown.
		<div class="hacker">
				&lt;!-- Directories to check  (perform all possible verifications) --><br/>
				&lt;directories report_changes="yes" realtime="yes" check_all="yes">/etc,/usr/bin,/usr/sbin&lt;/directories><br/>
				&lt;directories report_changes="yes" realtime="yes" check_all="yes">/bin,/sbin&lt;/directories><br/>
		</div>
		You can add more directories to monitor here. For exmample to add <code>/home/user_name </code> and <code>/var/www/ </code>add following line here.
		<div class="hacker">
			&lt;directories report_changes="yes" realtime="yes" restrict=".php|.js|.py|.sh|.html" check_all="yes">/home/user_name,/var/www&lt;/directories>
		</div>
		<code>restrict </code>setting tells only to monitor specified formats.
		</li>
		<li>
		<h3>Local rules location</h3>
		<p>Next files you would want to modify reside in <code>/var/ossec/rules</code>. In this directory if you use <code>ls -lgG</code> command, you will get a list of bunch of xml files but only two files <code>local_rules.xml </code>and <code>ossec_rules.xml</code> is of our use. The former file is used to add local rules and latter for default rules definitions.
			You will need sudo privileges to access these files. <!--This wording is very rough. Please revise. cj -->
      </p>
			<p>When a file is added to a monitored directory, the rule 554 is fired from <code>ossec_rules.xml</code>. By default it doesn't send alert on firing of this rule. so you'll need to change the settings. </p>
			<ol>
				<li>Default rule definitions in <code>ossec_rules.xml </code> are useful to look at so we can modify and copy them into our local files. Rule 554 looks like:
				
					<div class="hacker">
						
							&lt;rule id="554" level="0"><br/>
							&lt;category>ossec&lt;/category><br/>
							&lt;decoded_as>syscheck_new_entry&lt;/decoded_as><br/>
							&lt;description>File added to the system.&lt;/description><br/>
							&lt;group>syscheck,&lt;/group><br/>
							&lt;/rule><br/>
						
					</div>
					<p>When level is set to "0" no alert will be sent. We will raise the alert level.</p> 
				</li>
				<li>Copy the rule 554 and open the file <code>/var/ossec/rules/local_rules.xml</code> in any editor and add the new rule at the end within the group tag. Change the level to "7".
					<div class="hacker">
						
							&lt;rule id="554" level="7" overwrite="yes"><br/>
							&lt;category>ossec&lt;/category><br/>
							&lt;decoded_as>syscheck_new_entry&lt;/decoded_as><br/>
							&lt;description>File added to the system.&lt;/description><br/>
							&lt;group>syscheck,&lt;/group><br/>
							&lt;/rule><br/>
						
					</div>
				</li>
				<li>Save and close the file. </li>
				<li>Restart the OSSEC:
                  <div class="hacker">
    /var/ossec/bin/ossec-control restart
  </div>
				  <p>You will get a mail when it is restarted.</p>
			  </li>
			</ol>
		</li>
		<li>
		<h3>Triggering file change alerts</h3>
		<p>When you add any file in directory to be monitored by OSSEC or you update or delete a file, you should be getting alerts.
		It doesn't send real time notification for adding a file but only for modification or deletion. Alerts of file addition go after full system check which is handled by frequency check time in ossec.conf.
		</p>
	</li>
	</ol>
<h2>Next Steps</h2>
	<p><!--Please revise this section, following the editorial guidelines. cj -->
	After following all these steps you will be able to set up OSSEC notifications. To look for more customization, you can refer to its <a href="http://ossec-docs.readthedocs.org/en/latest/manual/index.html">official documentation.</a>
	</p>
</body>
</html>